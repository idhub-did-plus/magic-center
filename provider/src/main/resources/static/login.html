<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<title>Insert title here</title>
</head>
<body>

	<script type="text/javascript">
	var myDate = new Date();
		var timestamp = myDate.getTime();
	function sendLogin(signature){
	
		var ajax = new XMLHttpRequest();

		ajax.onreadystatechange = function(){
			
			if(ajax.readyState == 4 && ajax.status == 200){
				var msg = ajax.responseText;
				console.log(msg);
				//alert(msg);
				
			}
		}
		
		
		var identity = web3.eth.coinbase;
		ajax.open('get','auth/login?identity='+identity+'&timestamp='+timestamp + "&signature=" + signature);
		ajax.send(null);
	}

	
	
	function onsign(jj, msg){
        	sendLogin(msg);
        };
	function login(){
		var data = web3.fromUtf8(timestamp + web3.eth.coinbase)
        web3.personal.sign(data, web3.eth.coinbase,onsign);
       

　　　};
	
    window.addEventListener('load', function() {
        if (!window.web3) {//用来判断你是否安装了metamask
          window.alert('Please install MetaMask first.');//如果没有会去提示你先去安装
          return;
        }
	      if (window.ethereum) {
		        window.web3 = new Web3(ethereum);
		        try {
		            
		             ethereum.enable();
		            
		        } catch (error) {
		            // User denied account access...
		        }
	        }

       
	});
	</script>
	<input type="button" onclick="javascropt:login()">sign</input>
</body>
</html>